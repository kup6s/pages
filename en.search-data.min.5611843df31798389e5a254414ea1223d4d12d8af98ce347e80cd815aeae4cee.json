[{"id":0,"href":"/installation/","title":"Installation","section":"kup6s-pages","content":"Installation# Via Helm (Recommended)# # Install from OCI registry helm install pages oci://ghcr.io/kup6s/kup6s-pages --version 0.1.0 # Or with custom configuration helm install pages oci://ghcr.io/kup6s/kup6s-pages \\ --set operator.pagesDomain=pages.example.com \\ --set operator.clusterIssuer=letsencrypt-prod \\ --set \u0026#39;syncer.allowedHosts={github.com,gitlab.com}\u0026#39; \\ --set storage.storageClassName=longhorn \\ --set webhook.enabled=true \\ --set webhook.domain=webhook.pages.example.comKey Helm Values# Value Default Description operator.pagesDomain pages.kup6s.com Base domain for auto-generated URLs operator.clusterIssuer letsencrypt-prod cert-manager ClusterIssuer syncer.allowedHosts Required Allowed Git hosts (SSRF protection) storage.size 10Gi PVC size for sites storage.storageClassName (default) StorageClass (must support RWX) nginx.replicas 2 nginx replicas for HA webhook.enabled false Enable webhook IngressRoute webhook.domain webhook.pages.kup6s.com Webhook endpoint domain See Helm Values Reference for all options.\nVerify Installation# # Check operator and syncer are running kubectl get pods -n kup6s-pages # Check CRD is registered kubectl get crd staticsites.pages.kup6s.comExpected output:\nNAME READY STATUS RESTARTS AGE kup6s-pages-operator-xxx 1/1 Running 0 1m kup6s-pages-syncer-xxx 1/1 Running 0 1m kup6s-pages-nginx-xxx 1/1 Running 0 1m kup6s-pages-nginx-yyy 1/1 Running 0 1m"},{"id":1,"href":"/usage/private-repos/","title":"Private Repositories","section":"Usage","content":"Private Repositories# For private repositories, you need to:\nGrant the syncer access to secrets in your namespace Create a secret with your Git credentials Reference the secret in your StaticSite Step 1: Grant Syncer Access (RBAC)# The syncer does not have cluster-wide secret access. You must grant it access to read secrets in your namespace:\napiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: pages-syncer-secrets namespace: pages # Your namespace rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;secrets\u0026#34;] verbs: [\u0026#34;get\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: pages-syncer-secrets namespace: pages # Your namespace roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: pages-syncer-secrets subjects: - kind: ServiceAccount name: kup6s-pages-syncer # Syncer ServiceAccount (adjust if using custom release name) namespace: kup6s-pages # Syncer namespaceStep 2: Create a Secret# Create a Secret with your deploy token:\napiVersion: v1 kind: Secret metadata: name: my-repo-token namespace: pages type: Opaque stringData: password: \u0026#34;glpat-xxxxxxxxxxxx\u0026#34; # Your Forgejo/GitLab/GitHub token username: \u0026#34;git\u0026#34; # Optional, defaults to \u0026#34;git\u0026#34;Step 3: Reference the Secret# Reference the Secret in your StaticSite:\napiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: internal-docs namespace: pages spec: repo: https://forgejo.example.com/org/private-repo.git domain: docs.internal.example.com secretRef: name: my-repo-token key: password # Optional, defaults to \u0026#34;password\u0026#34;The Secret must be in the same namespace as the StaticSite. Without the RBAC setup, syncing will fail with \u0026ldquo;permission denied\u0026rdquo;.\nTroubleshooting# Authentication fails:\nVerify the RBAC is set up:\nkubectl get rolebinding pages-syncer-secrets -n pages Verify the Secret exists and has the correct key:\nkubectl get secret my-repo-token -n pages -o yaml Test the token manually:\ngit clone https://git:YOUR_TOKEN@forgejo.example.com/org/repo.git "},{"id":2,"href":"/reference/crd/","title":"StaticSite CRD","section":"Reference","content":"StaticSite CRD# The StaticSite Custom Resource Definition is the primary API for deploying static websites.\nAPI Version: pages.kup6s.com/v1beta1 Kind: StaticSite\nSpec Fields# Field Type Required Default Description repo string Yes - Git repository URL (HTTPS) branch string No main Git branch to track path string No / Subpath in repo to serve pathPrefix string No - URL path prefix (requires domain) domain string No \u0026lt;name\u0026gt;.\u0026lt;pages-domain\u0026gt; Custom domain secretRef.name string No - Secret name with Git credentials secretRef.key string No password Key in Secret for the token syncInterval string No 5m How often to pull updates Status Fields# Field Type Description phase string Current phase: Pending, Syncing, Ready, or Error message string Human-readable status message lastSync timestamp Timestamp of last successful sync lastCommit string Short SHA of the last synced commit url string Full URL of the deployed site syncToken string Auto-generated token for API authentication conditions []Condition Standard Kubernetes conditions resources.ingressRoute string Name of created IngressRoute resources.middleware string Name of created Middleware resources.stripMiddleware string Name of strip middleware (for pathPrefix) resources.certificate string Name of created Certificate Conditions# The status includes standard Kubernetes conditions:\nType Description Ready Site is deployed and accessible Synced Git repository is synced IngressReady IngressRoute is configured CertificateReady TLS certificate is issued Example# apiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: my-website namespace: pages spec: repo: https://github.com/user/my-website.git branch: main path: /dist domain: www.example.com syncInterval: 10m status: phase: Ready message: \u0026#34;Site is live\u0026#34; lastSync: \u0026#34;2024-01-15T10:30:00Z\u0026#34; lastCommit: \u0026#34;abc1234\u0026#34; url: \u0026#34;https://www.example.com\u0026#34; syncToken: \u0026#34;xxxxxxxx\u0026#34; resources: ingressRoute: \u0026#34;pages--my-website\u0026#34; middleware: \u0026#34;pages--my-website-prefix\u0026#34; certificate: \u0026#34;www-example-com-tls\u0026#34;Short Names# The CRD registers the short name ss for convenience:\nkubectl get ss -n pages kubectl describe ss my-website -n pages"},{"id":3,"href":"/usage/custom-domains/","title":"Custom Domains","section":"Usage","content":"Custom Domains# Each StaticSite can have its own custom domain with automatic TLS certificates.\nBasic Custom Domain# apiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: company-site namespace: pages spec: repo: https://github.com/company/website.git domain: www.company.comThe operator automatically:\nCreates a Traefik IngressRoute for Host(www.company.com) Creates a cert-manager Certificate Configures TLS termination DNS Configuration# Point your domain to the cluster\u0026rsquo;s Traefik load balancer IP:\nwww.company.com. A 203.0.113.10Or use a CNAME if your load balancer has a hostname:\nwww.company.com. CNAME lb.cluster.example.com.Certificate Status# Check if the certificate is ready:\nkubectl get certificate -n kup6s-pages kubectl describe certificate www-company-com-tls -n kup6s-pagesCommon issues:\nDNS not propagated yet Rate limits from Let\u0026rsquo;s Encrypt ClusterIssuer misconfigured Multiple Domains# Each StaticSite supports one domain. For multiple domains pointing to the same content, create multiple StaticSite resources:\napiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: site-www namespace: pages spec: repo: https://github.com/company/website.git domain: www.company.com --- apiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: site-apex namespace: pages spec: repo: https://github.com/company/website.git domain: company.comBoth sites share the same repo but get separate certificates.\n"},{"id":4,"href":"/reference/helm-values/","title":"Helm Values","section":"Reference","content":"Helm Values Reference# Complete reference for all Helm chart configuration options.\nGlobal# Value Default Description nameOverride \u0026quot;\u0026quot; Override the chart name fullnameOverride \u0026quot;\u0026quot; Override the full release name createNamespace true Create namespace (set to false if managed externally) namespace kup6s-pages Target namespace for deployment imagePullSecrets [] Global image pull secrets CRD Configuration# Value Default Description crds.install false Install CRD with the chart (use --skip-crds to skip) crds.keep true Keep CRD when chart is uninstalled Operator# Value Default Description operator.replicas 1 Number of operator replicas operator.image.registry ghcr.io Image registry operator.image.repository kup6s/pages-operator Image repository operator.image.tag \u0026quot;\u0026quot; Image tag (defaults to Chart.appVersion) operator.image.pullPolicy IfNotPresent Image pull policy operator.pagesDomain pages.kup6s.com Pages domain for auto-generated site URLs operator.clusterIssuer letsencrypt-prod cert-manager ClusterIssuer name operator.pagesTlsMode individual TLS mode for auto-generated domains: individual (HTTP-01 per site) or wildcard (pre-existing wildcard cert) operator.pagesWildcardSecret pages-wildcard-tls Secret name for wildcard certificate (only used when pagesTlsMode=wildcard) operator.metricsBindAddress :8080 Metrics bind address operator.healthProbeBindAddress :8081 Health probe bind address operator.extraArgs [] Additional CLI arguments operator.resources.limits.cpu 200m CPU limit operator.resources.limits.memory 128Mi Memory limit operator.resources.requests.cpu 100m CPU request operator.resources.requests.memory 64Mi Memory request operator.nodeSelector {} Node selector operator.tolerations [] Tolerations operator.affinity {} Affinity rules operator.serviceAccount.create true Create service account operator.serviceAccount.name \u0026quot;\u0026quot; Service account name operator.serviceAccount.annotations {} Service account annotations Syncer# Value Default Description syncer.replicas 1 Number of syncer replicas syncer.image.registry ghcr.io Image registry syncer.image.repository kup6s/pages-syncer Image repository syncer.image.tag \u0026quot;\u0026quot; Image tag (defaults to Chart.appVersion) syncer.image.pullPolicy IfNotPresent Image pull policy syncer.syncInterval 5m Default sync interval for git repositories syncer.webhookAddr :8080 Webhook server listen address syncer.sitesRoot /sites Sites root directory syncer.allowedHosts [] Required. Allowed Git hosts for SSRF protection syncer.extraArgs [] Additional CLI arguments syncer.resources.limits.cpu 500m CPU limit syncer.resources.limits.memory 256Mi Memory limit syncer.resources.requests.cpu 100m CPU request syncer.resources.requests.memory 128Mi Memory request syncer.nodeSelector {} Node selector syncer.tolerations [] Tolerations syncer.affinity {} Affinity rules syncer.serviceAccount.create true Create service account syncer.serviceAccount.name \u0026quot;\u0026quot; Service account name syncer.service.type ClusterIP Service type syncer.service.port 80 Service port nginx# Value Default Description nginx.replicas 2 Number of nginx replicas for HA nginx.image.registry docker.io Image registry nginx.image.repository library/nginx Image repository nginx.image.tag 1.25-alpine Image tag nginx.image.pullPolicy IfNotPresent Image pull policy nginx.resources.limits.cpu 200m CPU limit nginx.resources.limits.memory 128Mi Memory limit nginx.resources.requests.cpu 50m CPU request nginx.resources.requests.memory 64Mi Memory request nginx.nodeSelector {} Node selector nginx.tolerations [] Tolerations nginx.affinity (pod anti-affinity) Affinity rules nginx.service.type ClusterIP Service type nginx.service.port 80 Service port nginx.customConfig \u0026quot;\u0026quot; Custom nginx configuration nginx.pdb.enabled true Enable PodDisruptionBudget nginx.pdb.minAvailable 1 Minimum available pods Storage# Value Default Description storage.existingClaim \u0026quot;\u0026quot; Use existing PVC instead of creating one storage.storageClassName \u0026quot;\u0026quot; Storage class name (empty uses cluster default) storage.size 10Gi Storage size storage.accessModes [ReadWriteMany] Access modes storage.annotations {} PVC annotations Webhook# Value Default Description webhook.enabled false Enable webhook IngressRoute and Certificate webhook.domain webhook.pages.kup6s.com Webhook domain webhook.clusterIssuer \u0026quot;\u0026quot; ClusterIssuer (defaults to operator.clusterIssuer) webhook.entryPoints [websecure] Traefik entrypoints webhook.annotations {} Additional IngressRoute annotations webhook.secret \u0026quot;\u0026quot; Webhook secret for HMAC validation webhook.secretRef.name \u0026quot;\u0026quot; Reference to existing secret webhook.secretRef.key webhook-secret Key in the secret RBAC# Value Default Description rbac.create true Create ClusterRole and ClusterRoleBinding resources "},{"id":5,"href":"/usage/","title":"Usage","section":"kup6s-pages","content":"Usage# This section covers how to deploy static websites using kup6s-pages.\nBasic Example# Create a StaticSite resource to deploy a website from a Git repository:\napiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: my-website namespace: pages spec: repo: https://github.com/user/my-website.git domain: www.example.comThe operator will:\nCreate a Traefik Middleware (my-website-prefix) with addPrefix: /my-website Create a Traefik IngressRoute for Host(www.example.com) Create a cert-manager Certificate for the domain The Syncer clones the repo to /sites/my-website/ Check Status# # List all sites kubectl get staticsites -A # Detailed status kubectl describe staticsite my-website -n pages # Short form kubectl get ss -n pagesAuto-Generated Domain# If no domain is specified, the site gets a subdomain of the configured pages domain:\napiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: my-project namespace: pages spec: repo: https://github.com/user/my-project.git # No domain specified → https://my-project.pages.kup6s.comBuild Output Subpath# For sites with build tools (Vite, Hugo, Sphinx, etc.) where the output is in a subdirectory:\napiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: docs namespace: pages spec: repo: https://github.com/user/docs.git branch: main path: /dist # Serve only the /dist directory domain: docs.example.comThe Syncer clones to /sites/.repos/docs/ and creates a symlink /sites/docs/ → /sites/.repos/docs/dist/.\n"},{"id":6,"href":"/reference/cli-flags/","title":"CLI Flags","section":"Reference","content":"CLI Flags# Command-line flags for the operator and syncer components.\nOperator Flags# Flag Default Description --pages-domain pages.kup6s.com Base domain for auto-generated subdomains --cluster-issuer letsencrypt-prod cert-manager ClusterIssuer name --nginx-namespace kup6s-pages Namespace where nginx service runs --nginx-service-name kup6s-pages-nginx Name of the nginx service --pages-tls-mode individual TLS mode for auto-generated domains: individual or wildcard --pages-wildcard-secret pages-wildcard-tls Secret name for wildcard certificate (only used with --pages-tls-mode=wildcard) --metrics-bind-address :8080 Metrics endpoint --health-probe-bind-address :8081 Health probe endpoint TLS Modes# Mode Description individual Creates a Certificate per site using HTTP-01 challenge. Works without DNS provider API access. wildcard References a pre-existing wildcard certificate. Requires external DNS-01 setup for wildcard cert issuance. Note: Wildcard mode requires a pre-existing *.{pagesDomain} certificate. This must be created externally using DNS-01 challenge, as Let\u0026rsquo;s Encrypt doesn\u0026rsquo;t support wildcard certs via HTTP-01.\nExample# go run ./cmd/operator \\ --pages-domain=pages.example.com \\ --cluster-issuer=letsencrypt-prod \\ --nginx-namespace=kup6s-pages \\ --nginx-service-name=kup6s-pages-nginx \\ --pages-tls-mode=individualSyncer Flags# Flag Default Description --sites-root /sites Directory where sites are stored --sync-interval 5m Default interval for polling repos --webhook-addr :8080 Webhook HTTP server address --allowed-hosts Required Comma-separated allowlist of Git hosts --webhook-secret \u0026quot;\u0026quot; Secret for webhook HMAC validation Example# go run ./cmd/syncer \\ --sites-root=/sites \\ --sync-interval=5m \\ --webhook-addr=:8080 \\ --allowed-hosts=github.com,gitlab.com,forgejo.example.com \\ --webhook-secret=your-secret-hereAllowed Hosts# The --allowed-hosts flag provides SSRF (Server-Side Request Forgery) protection. The syncer will only clone repositories from these hosts.\nCommon values:\ngithub.com gitlab.com bitbucket.org codeberg.org Wildcards are supported for self-hosted instances:\n*.gitlab.example.com git.internal.company.com Example:\n--allowed-hosts=github.com,gitlab.com,*.gitlab.internal.example.com"},{"id":7,"href":"/usage/path-prefix/","title":"Path Prefix","section":"Usage","content":"Path Prefix# Serve multiple repositories under different paths of the same domain.\nUse Case# You want to serve archived content or versioned documentation under paths like:\nhttps://www.example.com/2019/ https://www.example.com/2020/ https://www.example.com/v1/docs/ Configuration# apiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: archive-2019 namespace: pages spec: repo: https://github.com/org/archive-2019.git domain: www.example.com pathPrefix: /2019 --- apiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: archive-2020 namespace: pages spec: repo: https://github.com/org/archive-2020.git domain: www.example.com pathPrefix: /2020How It Works# Both sites share the same TLS certificate (one per domain) Traefik routes based on path prefix before the host match Requests to https://www.example.com/2019/page.html serve from archive-2019 repo Requests to https://www.example.com/2020/page.html serve from archive-2020 repo Requirements# pathPrefix requires a custom domain to be set Path prefixes must be unique per domain The prefix is stripped before serving (so /2019/index.html serves index.html from the repo) Root Path# To serve a \u0026ldquo;main\u0026rdquo; site at the root while having prefixed sub-sites, create a site without pathPrefix:\napiVersion: pages.kup6s.com/v1beta1 kind: StaticSite metadata: name: main-site namespace: pages spec: repo: https://github.com/org/main-website.git domain: www.example.com # No pathPrefix → serves at rootTraefik will route /2019/* and /2020/* to their respective sites, and everything else to the main site.\n"},{"id":8,"href":"/reference/","title":"Reference","section":"kup6s-pages","content":"Reference# API and configuration reference for kup6s-pages.\nStaticSite CRD - Custom Resource Definition fields Helm Values - All Helm chart configuration options CLI Flags - Operator and Syncer command-line flags "},{"id":9,"href":"/troubleshooting/","title":"Troubleshooting","section":"kup6s-pages","content":"Troubleshooting# Common issues and solutions.\nSite Stuck in \u0026ldquo;Pending\u0026rdquo;# The site was created but never transitions to \u0026ldquo;Ready\u0026rdquo;.\nCheck the Syncer logs:\nkubectl logs -n kup6s-pages -l app=pages-syncerCommon causes:\nGit host not in allowedHosts (SSRF protection) Repository URL invalid or inaccessible Network issues reaching the Git host Certificate Not Ready# TLS certificate is not being issued.\nCheck cert-manager:\nkubectl get certificate -n kup6s-pages kubectl describe certificate my-website-tls -n kup6s-pagesCommon causes:\nDNS not propagated yet Let\u0026rsquo;s Encrypt rate limits ClusterIssuer misconfigured HTTP-01 challenge failing (check Traefik ingress) 404 Errors# Site shows 404 for all pages.\n1. Verify the site directory exists:\nkubectl exec -n kup6s-pages deploy/pages-syncer -- ls -la /sites/2. Check if the repo was cloned successfully:\nkubectl get staticsite my-website -n pages -o yaml3. Check the StaticSite status:\nkubectl describe staticsite my-website -n pagesCommon causes:\nRepo not yet cloned (check status.phase) Wrong path configured (subpath doesn\u0026rsquo;t exist in repo) nginx not running or not mounting PVC Private Repo Authentication Fails# Syncing fails with \u0026ldquo;authentication required\u0026rdquo; or \u0026ldquo;permission denied\u0026rdquo;.\n1. Verify the RBAC is set up:\nkubectl get rolebinding pages-syncer-secrets -n pagesIf missing, see Private Repositories for RBAC setup.\n2. Verify the Secret exists and has the correct key:\nkubectl get secret my-repo-token -n pages -o yaml3. Test the token manually:\ngit clone https://git:YOUR_TOKEN@forgejo.example.com/org/repo.gitForce Re-sync# Trigger a manual sync using the site\u0026rsquo;s sync token:\n# Get the sync token from the StaticSite status TOKEN=$(kubectl get staticsite my-website -n pages -o jsonpath=\u0026#39;{.status.syncToken}\u0026#39;) # Trigger sync with authentication curl -H \u0026#34;X-API-Key: $TOKEN\u0026#34; -X POST https://webhook.pages.example.com/sync/pages/my-websiteWebhook Not Triggering# Pushes to the repository don\u0026rsquo;t trigger updates.\n1. Check the syncer logs:\nkubectl logs -n kup6s-pages -l app=pages-syncer2. Verify webhook IngressRoute exists:\nkubectl get ingressroute -n kup6s-pages3. Verify webhook secret matches: The secret configured in Helm values must match the secret configured in your Git provider.\n4. Test manually:\ncurl -v https://webhook.pages.example.com/healthPods Not Starting# Components fail to start or crash loop.\nCheck pod status:\nkubectl get pods -n kup6s-pages kubectl describe pod \u0026lt;pod-name\u0026gt; -n kup6s-pagesCommon causes:\nImage pull errors (check imagePullSecrets) PVC not bound (check storage.storageClassName) Resource limits too low Security context issues (non-root user, read-only filesystem) View All Resources# List all resources created by kup6s-pages:\n# StaticSites kubectl get staticsites -A # Generated Traefik resources kubectl get ingressroute,middleware -n kup6s-pages # Certificates kubectl get certificate -n kup6s-pages # Core components kubectl get deploy,svc,pvc -n kup6s-pages"},{"id":10,"href":"/usage/webhooks/","title":"Webhooks","section":"Usage","content":"Webhooks# For instant deployments on push, configure webhooks in your Git provider.\nEnable Webhook Ingress# Enable webhooks in your Helm values. A webhook secret is required for HMAC signature validation:\nwebhook: enabled: true domain: \u0026#34;webhook.pages.example.com\u0026#34; clusterIssuer: \u0026#34;letsencrypt-prod\u0026#34; # Required: set a secret for HMAC validation secret: \u0026#34;your-webhook-secret-here\u0026#34; # Or reference an existing secret: # secretRef: # name: \u0026#34;my-webhook-secret\u0026#34; # key: \u0026#34;webhook-secret\u0026#34;This creates the IngressRoute and Certificate automatically. The same secret must be configured in your Git provider\u0026rsquo;s webhook settings.\nWebhook Endpoints# Provider URL Forgejo/Gitea https://webhook.pages.example.com/webhook/forgejo GitHub https://webhook.pages.example.com/webhook/github Manual sync POST /sync/{namespace}/{name} (requires X-API-Key header) Configure in Forgejo/Gitea# Go to Repository → Settings → Webhooks → Add Webhook URL: https://webhook.pages.example.com/webhook/forgejo Content Type: application/json Secret: Use the same secret configured in webhook.secret Events: Push events Configure in GitHub# Go to Repository → Settings → Webhooks → Add webhook Payload URL: https://webhook.pages.example.com/webhook/github Content type: application/json Secret: Use the same secret configured in webhook.secret Events: Just the push event Manual Sync# Trigger a manual sync using the site\u0026rsquo;s sync token:\n# Get the sync token from the StaticSite status TOKEN=$(kubectl get staticsite my-website -n pages -o jsonpath=\u0026#39;{.status.syncToken}\u0026#39;) # Trigger sync with authentication curl -H \u0026#34;X-API-Key: $TOKEN\u0026#34; -X POST https://webhook.pages.example.com/sync/pages/my-websiteTroubleshooting# Webhook not triggering:\nCheck the syncer logs:\nkubectl logs -n kup6s-pages -l app=pages-syncer Verify the webhook secret matches in both Helm values and Git provider settings\nCheck the IngressRoute exists:\nkubectl get ingressroute -n kup6s-pages Test manually with curl to verify connectivity\n"},{"id":11,"href":"/architecture/","title":"Architecture","section":"kup6s-pages","content":"Architecture# Technical overview of the kup6s-pages architecture.\nProblem Statement# Existing solutions for static website hosting on Kubernetes are either inefficient or difficult to integrate:\nKubero and similar PaaS solutions start one Pod per website. With many small static sites, this leads to significant resource overhead.\nCodeberg pages-server is efficient (one container for all sites) but handles TLS on its own. This conflicts with the standard Kubernetes pattern (Ingress Controller + cert-manager) and requires SSL passthrough, which prevents Layer-7 features like path routing.\ngit-sync as sidecar only synchronizes one repository per container. For many sites, you\u0026rsquo;d need many sidecars.\nDesign Goals# Resource efficiency: One nginx Pod serves all sites Kubernetes-native: Integration with Traefik IngressController and cert-manager Declarative: Sites are defined as Custom Resources Git-based: Automatic synchronization from Git repositories Custom Domains: Each site can have its own domain Simple: Minimal configuration for the end user Components# ┌─────────────────────────────────────────────────────────────────────────┐ │ │ │ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ │ │ │ StaticSite │ │ StaticSite │ │ StaticSite │ ... │ │ │ CRD │ │ CRD │ │ CRD │ │ │ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘ │ │ │ │ │ │ │ └─────────────────────┼─────────────────────┘ │ │ │ │ │ ▼ │ │ ┌────────────────┐ │ │ │ Operator │ │ │ │ │ │ │ │ • Watches CRDs │ │ │ │ • Creates: │ │ │ │ - Ingress │ │ │ │ - Middleware │ │ │ │ - Certific. │ │ │ └────────────────┘ │ │ │ │ ┌──────────────────────┼──────────────────────┐ │ │ │ │ │ │ │ ▼ ▼ ▼ │ │ ┌────────────┐ ┌─────────────┐ ┌─────────────┐ │ │ │ Traefik │ │ Traefik │ │ cert-manager│ │ │ │ Ingress- │ │ Middleware │ │ Certificate │ │ │ │ Route │ │ (addPrefix) │ │ │ │ │ └────────────┘ └─────────────┘ └─────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘ ┌─────────────────────────────────────────────────────────────────────────┐ │ │ │ ┌────────────────┐ │ │ │ Syncer │ │ │ │ │ │ │ │ • Reads CRDs │ │ │ │ • Git clone/ │ │ │ │ pull │ │ │ │ • Webhook API │ │ │ └───────┬────────┘ │ │ │ │ │ ▼ │ │ ┌─────────────────────┐ │ │ │ PVC: /sites │ │ │ │ ├── site-a/ │ │ │ │ ├── site-b/ │ │ │ │ └── site-c/ │ │ │ └──────────┬──────────┘ │ │ │ │ │ ▼ │ │ ┌─────────────────────┐ │ │ │ nginx (1 Pod) │ │ │ │ root /sites; │ │ │ └─────────────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘Operator# Watches StaticSite resources across all namespaces and creates:\nTraefik IngressRoute for routing traffic Traefik Middleware with addPrefix for path-based routing cert-manager Certificate for TLS All generated resources are created in the system namespace (kup6s-pages) for improved security.\nSyncer# Synchronizes Git repositories to the shared PVC:\nPeriodically polls all StaticSite CRDs Clones new repos, pulls existing ones Supports private repos via Secrets Provides HTTP API for webhooks nginx# A single nginx Deployment serves all sites with a static configuration:\nserver { listen 80; root /sites; location / { try_files $uri $uri/ $uri/index.html =404; } }No dynamic configuration needed - routing is handled by Traefik via addPrefix.\nRequest Flow# HTTPS Request: www.customer.com/about.html │ │ 1. TLS Termination (Traefik) ▼ ┌─────────────────────────────────────────────────────┐ │ Traefik │ │ │ │ Route Match: Host(`www.customer.com`) │ │ Middleware: addPrefix(/customer-website) │ │ │ │ Internal Request: /customer-website/about.html │ └────────────────────────┬────────────────────────────┘ │ │ 2. HTTP to nginx Service ▼ ┌─────────────────────────────────────────────────────┐ │ nginx │ │ │ │ root /sites; │ │ Request: /customer-website/about.html │ │ Served: /sites/customer-website/about.html │ └────────────────────────┬────────────────────────────┘ │ │ 3. File from PVC ▼ ┌─────────────────────────────────────────────────────┐ │ PVC: /sites │ │ │ │ /sites/customer-website/ │ │ ├── index.html │ │ ├── about.html ◄── This file │ │ └── assets/ │ └─────────────────────────────────────────────────────┘Sync Flow# Periodic Sync# ┌──────────────┐ ┌─────────────────────────────────────┐ │ Syncer │ │ Kubernetes API │ │ │ │ │ │ Timer: 5m │────▶│ GET /apis/pages.kup6s.com/v1beta1/ │ │ │ │ staticsites │ └──────┬───────┘ └─────────────────────────────────────┘ │ │ For each StaticSite: ▼ ┌──────────────────────────────────────────────────────────┐ │ │ │ if /sites/\u0026lt;name\u0026gt;/.git exists: │ │ git pull │ │ else: │ │ git clone --depth=1 \u0026lt;repo\u0026gt; /sites/\u0026lt;name\u0026gt; │ │ │ │ Status Update: lastSync, lastCommit │ │ │ └──────────────────────────────────────────────────────────┘Webhook Sync (Instant)# ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ │ Forgejo │ │ Traefik │ │ Syncer │ │ │ │ │ │ │ │ git push │────▶│ webhook. │────▶│ POST │ │ │ │ pages. │ │ /webhook/ │ │ │ │ kup6s.io │ │ forgejo │ └──────────────┘ └──────────────┘ └──────┬───────┘ │ ┌─────────────────────────────────────────┘ │ ▼ ┌──────────────────────────────────────────────────────────┐ │ │ │ 1. Parse Webhook Payload (repo URL, branch) │ │ 2. Find all StaticSites with this repo URL │ │ 3. git pull for each matching site │ │ 4. Status Update │ │ │ └──────────────────────────────────────────────────────────┘Resource Efficiency# Approach 100 Sites 1000 Sites Pod per Site 100 Pods 1000 Pods kup6s-pages 3 Pods 3 Pods The three Pods are: Operator (1), Syncer (1), nginx (1-2 for HA).\nNo Dynamic nginx Configuration# The addPrefix pattern eliminates the need to reconfigure nginx for each new site:\nNo ConfigMap updates No nginx reload No race conditions Security Model# Operator: ClusterRole for watching StaticSites, but only creates resources in the system namespace Syncer: No cluster-wide secret access by default (opt-in via namespace Roles) SSRF Protection: Mandatory --allowed-hosts flag restricts which Git hosts can be accessed Pod Security: All pods run as non-root with read-only root filesystem See Security for detailed RBAC documentation.\nDeployment Overview# Namespace: kup6s-pages (System) ├── Deployment: pages-operator │ └── Pod: operator ├── Deployment: pages-syncer │ └── Pod: syncer ├── Deployment: static-sites-nginx │ └── Pod: nginx (replicas: 2) ├── Service: static-sites-nginx ├── Service: pages-syncer (for webhooks) ├── PVC: static-sites-data ├── ConfigMap: nginx-config ├── ServiceAccounts + RBAC │ │ Generated resources (all in system namespace): ├── IngressRoute: pages--customer-a-website (generated) ├── IngressRoute: pages--customer-b-docs (generated) ├── Middleware: pages--customer-a-website-prefix (generated) ├── Middleware: pages--customer-b-docs-prefix (generated) ├── Certificate: www-customer-a-com-tls (generated) └── Certificate: docs-customer-b-com-tls (generated) Namespace: pages (User Sites) ├── StaticSite: customer-a-website ├── StaticSite: customer-b-docs └── Secret: git-credentials (optional)Note: All generated Traefik and cert-manager resources are created in the system namespace for improved security. Users can see resource references via status.resources.\nLimitations# RWX Storage required: The PVC must support ReadWriteMany (e.g., Longhorn, NFS, CephFS) No Build Pipeline: Only serves static files (build in CI/CD) No Preview Deployments: Each StaticSite is a fixed configuration Single Point of Sync: The Syncer is a single Pod Future Extensions# Preview Deployments: Automatic sites for Pull Requests Build Integration: Optional build container before sync Metrics: Prometheus metrics for sync status and errors UI: Web dashboard for site management Multi-Cluster: Sync to multiple clusters "},{"id":12,"href":"/security/","title":"Security","section":"kup6s-pages","content":"Security# This document describes the RBAC configuration and security considerations for kup6s-pages.\nRBAC Architecture# The operator uses a split RBAC model for improved security:\nClusterRole: Read-only access to StaticSites across all namespaces Role: Full CRUD on generated resources in the system namespace only This design minimizes the blast radius - a compromised operator can only affect resources in the system namespace, not user namespaces.\nResource Creation Pattern# All managed resources are created in the system namespace (where the operator runs), not in user namespaces:\nResource Location Naming Pattern Ownership IngressRoutes System namespace {site-ns}--{site-name} Labels (explicit cleanup) Middlewares System namespace {site-ns}--{site-name}-prefix Labels (explicit cleanup) Certificates System namespace {domain}-tls Labels (shared across sites) Users can see which resources were created via the StaticSite status:\nstatus: resources: ingressRoute: kup6s-pages/customer-ns--my-site middleware: kup6s-pages/customer-ns--my-site-prefix certificate: kup6s-pages/www-example-com-tlsOperator Permissions# ClusterRole (cluster-wide, read-heavy)# # StaticSite CRD verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;] # update/patch for finalizers # StaticSite status verbs: [\u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;] # StaticSite finalizers verbs: [\u0026#34;update\u0026#34;] # Events verbs: [\u0026#34;create\u0026#34;, \u0026#34;patch\u0026#34;] get/list/watch: Core reconciliation loop update/patch: Adding finalizers for cleanup coordination create/delete: Not granted (users create/delete StaticSites) Role (system namespace only)# # Traefik IngressRoutes and Middlewares verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;delete\u0026#34;] # cert-manager Certificates verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;delete\u0026#34;] # Coordination Leases (leader election) verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;delete\u0026#34;] create: Creates IngressRoutes, Middlewares, Certificates for each StaticSite delete: Required for explicit cleanup via finalizers Syncer Permissions# The syncer has minimal permissions - read-only access to StaticSites plus status updates:\n# StaticSites: read-only + status verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;] # for staticsites verbs: [\u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;] # for staticsites/statusSecrets access is not granted by default. Users must create namespace-scoped Roles to grant the syncer access to Git credentials. See Private Repos for configuration details.\nSecurity Benefits# Reduced Blast Radius# Aspect Before After Operator ClusterRole CRUD on Services, IngressRoutes, Certificates in ALL namespaces Read-only StaticSites + events Where resources are created User namespaces System namespace only Compromise impact Cluster-wide networking changes System namespace only Simplified Auditing# All generated resources are in one namespace, making it easier to:\nAudit what the operator has created Apply network policies Monitor for unexpected changes User Namespace Isolation# The operator never creates or modifies resources in user namespaces. Users only need to:\nCreate StaticSite CRDs Optionally grant syncer access to secrets (if using private repos) Shared Resource Management# Some resources are shared across multiple StaticSites:\nCertificates: Shared by sites with the same domain The operator uses labels to track ownership and performs explicit orphan checks before deletion to prevent accidental removal of resources still in use.\nCross-Namespace Secret Access (Syncer)# The syncer can be granted secrets access in user namespaces via RoleBindings:\napiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: pages-syncer-secrets namespace: customer-namespace rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;secrets\u0026#34;] verbs: [\u0026#34;get\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: pages-syncer-secrets namespace: customer-namespace roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: pages-syncer-secrets subjects: - kind: ServiceAccount name: kup6s-pages-syncer namespace: kup6s-pagesThis grants read-only access to secrets in the customer namespace only.\nAdditional Hardening# For environments requiring additional restrictions:\nOPA/Gatekeeper policies: Restrict which namespaces can contain StaticSites Network policies: Limit operator/syncer egress to required endpoints Pod security standards: Both operator and syncer run as non-root with read-only root filesystem Traefik namespace filtering: Configure Traefik to only watch IngressRoutes in the system namespace for additional isolation "},{"id":13,"href":"/development/","title":"Development","section":"kup6s-pages","content":"Development# Guide for contributors and developers.\nProject Structure# pages/ ├── cmd/ │ ├── operator/ # Operator entrypoint │ └── syncer/ # Syncer entrypoint ├── pkg/ │ ├── apis/v1alpha1/ # CRD types │ ├── controller/ # Reconciliation logic │ └── syncer/ # Git sync and webhook server └── charts/kup6s-pages/ # Helm chart ├── Chart.yaml ├── values.yaml ├── templates/ ├── crds/ └── tests/ # Helm unit testsPrerequisites# Go 1.21+ Helm 3 Docker (for building images) Access to a Kubernetes cluster (for testing) Build# # Build both binaries make build # Build individually make build-operator make build-syncerTest# # Go tests make test # Helm chart tests make helm-lint make helm-testRun Locally# # Operator (requires kubeconfig) make run-operator # Or with custom flags: go run ./cmd/operator --pages-domain=pages.local --cluster-issuer=selfsigned # Syncer make run-syncer # Or with custom flags: go run ./cmd/syncer --sites-root=./tmp/sites --sync-interval=30s --allowed-hosts=github.comCode Quality# # Run linter make lint # Format code make fmt # Vet make vet # Tidy dependencies make tidyDocker Images# # Build images make docker-build # Push images make docker-pushHelm Development# # Lint chart make helm-lint # Run unit tests make helm-test # Template chart (preview output) make helm-template # Install locally make deploy # Uninstall make undeployKey Packages# Package Description pkg/apis/v1alpha1 StaticSite CRD types and scheme registration pkg/controller Operator reconciliation logic pkg/syncer Git synchronization and webhook handlers Releasing# Version Scheme# We follow Semantic Versioning with pre-release identifiers:\nStable: 1.0.0, 1.1.0, 2.0.0 Alpha: 1.0.0-alpha.1, 1.0.0-alpha.2 (early testing, API may change) Beta: 1.0.0-beta.1, 1.0.0-beta.2 (feature complete, stabilizing) Release Candidate: 1.0.0-rc.1 (final testing before stable) What Gets Released# Each release publishes:\nArtifact Registry Example Tag Operator image ghcr.io/kup6s/pages-operator v1.0.0-alpha.1, 1.0.0-alpha.1 Syncer image ghcr.io/kup6s/pages-syncer v1.0.0-alpha.1, 1.0.0-alpha.1 Helm chart oci://ghcr.io/kup6s/kup6s-pages 1.0.0-alpha.1 Pre-Release Checklist# Before releasing:\nAll CI checks pass on main\n# Verify locally go test -race ./... go build ./... helm lint charts/kup6s-pages helm unittest charts/kup6s-pages Update CHANGELOG.md (if it exists) with release notes\nVerify Chart.yaml has placeholder version (workflow updates it automatically)\nversion: 0.1.0 # Will be overwritten by release workflow appVersion: \u0026#34;0.1.0\u0026#34; # Will be overwritten by release workflow Creating a Release# Option 1: GitHub CLI (Recommended)# # For alpha release gh release create v1.0.0-alpha.1 \\ --title \u0026#34;v1.0.0-alpha.1\u0026#34; \\ --notes \u0026#34;First alpha release of kup6s-pages\u0026#34; \\ --prerelease # For stable release gh release create v1.0.0 \\ --title \u0026#34;v1.0.0\u0026#34; \\ --notes \u0026#34;First stable release\u0026#34;Option 2: GitHub Web UI# Go to Releases → Draft a new release Click Choose a tag → type v1.0.0-alpha.1 → Create new tag Set Release title: v1.0.0-alpha.1 Write release notes describing changes Check Set as a pre-release for alpha/beta/rc versions Click Publish release After Release# The release workflow automatically:\nRuns all tests Builds Docker images with version tags Pushes images to ghcr.io Updates Chart.yaml with release version Packages and pushes Helm chart to OCI registry Monitor the workflow at: https://github.com/kup6s/pages/actions\nInstalling a Release# # Helm chart helm install pages oci://ghcr.io/kup6s/kup6s-pages --version 1.0.0-alpha.1 # Direct image reference ghcr.io/kup6s/pages-operator:v1.0.0-alpha.1 ghcr.io/kup6s/pages-syncer:v1.0.0-alpha.1Release Troubleshooting# Release workflow failed# Check workflow logs at GitHub Actions Common issues: Tests failing → fix and create new release Registry auth failed → check GITHUB_TOKEN permissions Helm push failed → ensure chart name matches repository Wrong version released# Delete the GitHub release Delete the git tag: git push --delete origin v1.0.0-alpha.1 Create a new release with correct version Yanking a release# To remove a broken release from use:\nMark GitHub release as pre-release to warn users Add warning to release notes Release a patch version with the fix Contributing# Fork the repository Create a feature branch Make your changes Run make lint and make test Submit a pull request Documentation# Documentation is built with Hugo using the Book theme.\n# Build docs make docs-build # Serve locally make docs-serve"}]