---
# Example: Namespace for user sites
apiVersion: v1
kind: Namespace
metadata:
  name: pages

---
# Example: Simple static site
apiVersion: pages.kup6s.io/v1alpha1
kind: StaticSite
metadata:
  name: demo-website
  namespace: pages
spec:
  repo: https://forgejo.kup6s.io/demo/website.git
  branch: main
  domain: demo.example.com

---
# Example: Site with build output subpath
apiVersion: pages.kup6s.io/v1alpha1
kind: StaticSite
metadata:
  name: docs-site
  namespace: pages
spec:
  repo: https://forgejo.kup6s.io/projekt/docs.git
  branch: main
  path: /dist  # e.g. Vitepress output

---
# Example: Private repo with credentials
apiVersion: pages.kup6s.io/v1alpha1
kind: StaticSite
metadata:
  name: internal-docs
  namespace: pages
spec:
  repo: https://forgejo.kup6s.io/internal/docs.git
  branch: main
  domain: docs.internal.example.com
  secretRef:
    name: forgejo-token
    key: password

---
# Secret for private repos (Base64 encoded)
# echo -n "your-token" | base64
apiVersion: v1
kind: Secret
metadata:
  name: forgejo-token
  namespace: pages
type: Opaque
data:
  password: ZGVpbi10b2tlbg==  # "your-token"

---
# IngressRoute for webhook endpoint
# So Forgejo can reach the Syncer directly
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: pages-webhook
  namespace: kup6s-pages
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`webhook.pages.kup6s.io`)
      kind: Rule
      services:
        - name: pages-syncer
          port: 80
  tls:
    secretName: pages-webhook-tls

---
# Certificate for webhook
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: pages-webhook-tls
  namespace: kup6s-pages
spec:
  secretName: pages-webhook-tls
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
  dnsNames:
    - webhook.pages.kup6s.io
